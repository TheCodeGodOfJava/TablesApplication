<div class="mat-elevation-z6 container">
  <div class="main-table">
    <table
      mat-table
      [dataSource]="dataSource.modelSubject"
      matSort
      matSortDisableClear
    >
      @for (column of columns; track column.alias; let i = $index) {
      <ng-container [matColumnDef]="column.alias || ''">
        <th mat-header-cell *matHeaderCellDef style="background-color: #f0f0f0">
          <div class="table-header">
            <div class="sort-div" mat-sort-header></div>
            <base-select
              [alias]="column.alias"
              [placeholder]="column.placeholder"
              [controllerPath]="controllerPath"
              [formGroup]="formGroup"
            />

            <button mat-icon-button (click)="clearCurrentFilter(column.alias)">
              <mat-icon>clear</mat-icon>
            </button>
          </div>
        </th>
        <td mat-cell *matCellDef="let row; let i = index">
          <div class="center-content">
            @if(row.visible){
            <base-input
              [alias]="column.alias"
              [placeholder]="column.placeholder"
              [controllerPath]="controllerPath"
              [formGroup]="getRowFormGroup(i)"
            ></base-input>
            }@else{
            {{ column.cell(row) }}
            }
          </div>
        </td>
      </ng-container>
      }
      <tr
        mat-header-row
        *matHeaderRowDef="getDisplayedColumns(); sticky: true"
      ></tr>
      <tr mat-row *matRowDef="let row; columns: getDisplayedColumns()"></tr>
    </table>
  </div>

  <div class="bottom-actions">
    <div class="control-buttons">
      <button
        mat-mini-fab
        matTooltip="Start search and reload the table"
        aria-label="Search and reload the table"
        (click)="reloadTable()"
      >
        <mat-icon>search</mat-icon>
      </button>
      <button
        mat-mini-fab
        matTooltip="Reset all the search filters"
        aria-label="Reset all the search filters"
        (click)="clearAllFilters()"
        style="margin-left: 10px"
      >
        <mat-icon>clear</mat-icon>
      </button>
    </div>
    <div class="paginator">
      <mat-paginator
        [pageSize]="pageSize"
        (page)="pageEvent($event)"
        [length]="dataSource.recordsTotalSubject | async"
        [pageSizeOptions]="pageSizeOptions"
        showFirstLastButtons
        [pageIndex]="0"
      >
      </mat-paginator>
    </div>
  </div>
</div>
